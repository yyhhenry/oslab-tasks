# 交换分区和全局页面置换

## 实验目的

本实验要求实验者在Linux 0.11上实现完整的虚拟内存请求调页和页面置换技术。Linux 0.11提供了请求调页的基本框架，有缺页中断处理函数，但只考虑了从磁盘（文件系统）调入页面的问题而没有考虑从内存调出页面到磁盘（此时不应该是文件系统，应该是交换分区）的情况。因此本实验要求实验者在Linux 0.11上实现页面调出，当然也需要实验者实现交换分区的管理。通过本实验，实验者可以充分理解内存管理、虚拟内存、块设备的管理等操作系统模块及这些模块间的关系；实验者需要编程实现块设备的管理、需要实现经典页面置换算法、需要将自己的代码和系统已有的请求调页机制和时钟管理机制等内容良好衔接，这将让实验者在操作系统的设计和实现上得到充分的锻炼。

## 实验内容

本实验的基本内容是在现有的Linux 0.11虚拟内存管理上完成完整的页面交换、交换分区和请求调页，从实现完整的虚拟内存。将主要完成如下三个方面的内容：

- 需要驱动交换分区，交换分区是虚拟内存的外部存储基础，所以实现完整虚拟内存的首要任务是实现交换分区的驱动和管理。实验者需要完成：
  - 在Bochs中用一块新的硬盘（当然是一个硬盘镜像文件）作为交换设备，实验者需要做的事情是定义交换设备的结构（空闲盘块组织等）、将交换设备按这种结构进行格式化、定义和实现操作交换设备的物理驱动函数（需要仿照现有Linux 0.11中的磁盘读写些函数，见文件ll_rw_blk.c）等。
  - 在交换设备的物理驱动函数基础上，实现内存页面和磁盘页面的交换。在交换时实验者需要考虑在磁盘页面调入时如何快速的找到这些页面等问题。
- 需要设计和实现内存页面交换算法，本实验内容要求实验者完成：
  - 页面换出的双指针clock全局页面淘汰算法，其中一个指针用来定期清除页面访问标志，另一个指针用来找到淘汰页，此时要求修改现有的Linux 0.11时钟中断处理算法。
  - 要求实验者提供一个可以查看页面扫描情况的命令，可以打印出扫描圈数，换出页面个数等信息。
  - 要求实验者能对指针扫描速度参数的设定给出一定的实验数据分析。
- 实验者需要补充现有的Linux 0.11请求页面机制：
  - 使得在考虑缺页处理时，不只是简单的将所缺页面读入，也需要考虑如果内存空闲页面不足（可以仿照Solaris设置一个下界值）时，进程睡眠等待其它进程的页面换出。
  - 适当的打出一些信息（或者写入到日志文件中）来表示Linux 0.11请求调页完整版的工作情况。
